version: 2

models:
  - name: DimMembershipAccounts
    description: "Dimension table for membership accounts"
    config:
      materialized: table
      unique_key: 'DimMembershipAccountId'
    columns:
      - name: DimMembershipAccountId
        description: "Auto-incremental primary key for membership accounts dimension"
      - name: AccountNumberFull
        description: "Business key - full account number (Cost Center + Account Number)"
      - name: ClubNumber
        description: "Club number where the account belongs"
      - name: HomeClubNumber
        description: "Home club number for the account"
      - name: AccountType
        description: "Type of account (DI=Individual, BS=Business)"
      - name: AccountNumber
        description: "Account number within the club"
      - name: Complimentary
        description: "Whether the account is complimentary"
      - name: DateAccountOpened
        description: "Date when the account was opened"
      - name: EffectiveDate
        description: "Effective date of the account"
      - name: ExpirationDate
        description: "Expiration date of the account"
      - name: CancelDate
        description: "Date when the account was cancelled"
      - name: BusinessName
        description: "Business name for business accounts"
      - name: BSBusinessType
        description: "Business type for business accounts"
      - name: PlatinumAccount
        description: "Whether the account is platinum"
      - name: NumberOfEmployees
        description: "Number of employees for business accounts"
      - name: BusinessLicenseNumber
        description: "Business license number"
      - name: CreateDate
        description: "Record creation timestamp"
      - name: UpdateDate
        description: "Record last update timestamp"
    tests:
      # Primary Key Tests
      - not_null:
          column_name: DimMembershipAccountId
      - unique:
          column_name: DimMembershipAccountId
      # Business Key Tests
      - not_null:
          column_name: AccountNumberFull
      - unique:
          column_name: AccountNumberFull
      # Required Field Tests
      - not_null:
          column_name: ClubNumber
      - not_null:
          column_name: AccountType
      - not_null:
          column_name: AccountNumber
      - not_null:
          column_name: PlatinumAccount
      - not_null:
          column_name: CreateDate
      - not_null:
          column_name: UpdateDate
      # Data Quality Tests
      - accepted_values:
          column_name: AccountType
          values: ['DI', 'BS']
      # Unique Constraint Tests
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - AccountNumberFull
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - DimMembershipAccountId
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - ClubNumber
            - AccountNumber

  - name: DimMembershipCards
    description: "Dimension table for membership cards"
    config:
      materialized: table
      unique_key: 'DimMembershipCardId'
    columns:
      - name: DimMembershipCardId
        description: "Auto-incremental primary key for membership cards dimension"
      - name: MembershipNumber
        description: "Business key - full membership number (Cost Center + Account + Card)"
      - name: AccountNumberFull
        description: "Full account number this card belongs to"
      - name: ClubNumber
        description: "Club number where the card was issued"
      - name: CardNumber
        description: "Card number within the account"
      - name: BlockStatus
        description: "Status of the card (blocked/active)"
      - name: CancelDate
        description: "Date when the card was cancelled"
      - name: HasCellPhone
        description: "Whether the member has provided cell phone"
      - name: HasEmail
        description: "Whether the member has provided email"
      - name: MemEvent
        description: "Membership event code"
      - name: Zone
        description: "Geographic zone"
      - name: AwarenessCode
        description: "Awareness code for marketing"
      - name: WayOfNotification
        description: "Preferred way of notification"
      - name: DateOfBirth
        description: "Member's date of birth"
      - name: IssuedDate
        description: "Date when the card was issued"
      - name: Gender
        description: "Member's gender"
      - name: CardType
        description: "Type of membership card"
      - name: Country
        description: "Member's country"
      - name: DiamondBusinessType
        description: "Diamond business type"
      - name: MemberStatus
        description: "Status of the member"
      - name: PrimaryCard
        description: "Whether this is the primary card"
      - name: Dual
        description: "Dual membership indicator"
      - name: AutoCharge
        description: "Auto charge indicator"
      - name: CreateDate
        description: "Record creation timestamp"
      - name: UpdateDate
        description: "Record last update timestamp"
    tests:
      # Primary Key Tests
      - not_null:
          column_name: DimMembershipCardId
      - unique:
          column_name: DimMembershipCardId
      # Business Key Tests
      - not_null:
          column_name: MembershipNumber
      - unique:
          column_name: MembershipNumber
      # Required Field Tests
      - not_null:
          column_name: AccountNumberFull
      - not_null:
          column_name: ClubNumber
      - not_null:
          column_name: CardNumber
      - not_null:
          column_name: HasCellPhone
      - not_null:
          column_name: HasEmail
      - not_null:
          column_name: PrimaryCard
      - not_null:
          column_name: CreateDate
      - not_null:
          column_name: UpdateDate
      # Unique Constraint Tests
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - MembershipNumber
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - DimMembershipCardId
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - ClubNumber
            - AccountNumber
            - CardNumber

  - name: FactMembershipTransactions
    description: "Fact table for membership transactions"
    config:
      materialized: table
      unique_key: 'FactMembershipTransactionId'
    columns:
      - name: FactMembershipTransactionId
        description: "Auto-incremental primary key for membership transactions fact"
      - name: DimClubNumberId
        description: "Foreign key to DimClubs.DimClubId"
      - name: DimMembershipAccountId
        description: "Foreign key to DimMembershipAccounts.DimMembershipAccountId"
      - name: DimDateTransactionDateId
        description: "Foreign key to DimDates.DimDateId for transaction date"
      - name: DimDateEffectiveDateId
        description: "Foreign key to DimDates.DimDateId for effective date"
      - name: DimDateExpiredDateId
        description: "Foreign key to DimDates.DimDateId for expired date"
      - name: AccountNumber
        description: "Account number for the transaction"
      - name: OrderNumber
        description: "Order number for the transaction"
      - name: TransactionDate
        description: "Date of the transaction"
      - name: AccountType
        description: "Type of account (DI/BS)"
      - name: TransactionType
        description: "Type of transaction"
      - name: ExpiredDate
        description: "Expiration date of the transaction"
      - name: EffectiveDate
        description: "Effective date of the transaction"
      - name: HomeCostCenter
        description: "Home cost center for the transaction"
      - name: PlatinumTransaction
        description: "Whether this is a platinum transaction"
      - name: SalesOrderNumber
        description: "Sales order number"
      - name: InvoiceNumber
        description: "Invoice number"
      - name: TotalCost
        description: "Total cost of the transaction"
      - name: TotalUsdCostNet
        description: "Total USD cost net of the transaction"
      - name: CreateDate
        description: "Record creation timestamp"
      - name: UpdateDate
        description: "Record last update timestamp"
    tests:
      # Primary Key Tests
      - not_null:
          column_name: FactMembershipTransactionId
      - unique:
          column_name: FactMembershipTransactionId
      # Foreign Key Tests
      - not_null:
          column_name: DimClubNumberId
      - relationships:
          column_name: DimClubNumberId
          to: ref('DimClubs')
          field: DimClubId
      - not_null:
          column_name: DimMembershipAccountId
      - relationships:
          column_name: DimMembershipAccountId
          to: ref('DimMembershipAccounts')
          field: DimMembershipAccountId
      - not_null:
          column_name: DimDateTransactionDateId
      - relationships:
          column_name: DimDateTransactionDateId
          to: ref('DimDates')
          field: DimDateId
      - relationships:
          column_name: DimDateEffectiveDateId
          to: ref('DimDates')
          field: DimDateId
      - relationships:
          column_name: DimDateExpiredDateId
          to: ref('DimDates')
          field: DimDateId
      # Required Field Tests
      - not_null:
          column_name: AccountNumber
      - not_null:
          column_name: OrderNumber
      - not_null:
          column_name: TransactionDate
      - not_null:
          column_name: AccountType
      - not_null:
          column_name: TransactionType
      - not_null:
          column_name: EffectiveDate
      - not_null:
          column_name: TotalCost
      - not_null:
          column_name: TotalUsdCostNet
      - not_null:
          column_name: CreateDate
      - not_null:
          column_name: UpdateDate
      # Data Quality Tests
      - accepted_values:
          column_name: AccountType
          values: ['DI', 'BS']
      # Unique Constraint Tests
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - FactMembershipTransactionId
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - OrderNumber
