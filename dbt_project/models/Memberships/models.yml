version: 2

models:
  - name: DimMembershipAccounts
    description: "Dimension table for membership accounts"
    config:
      materialized: table
      unique_key: 'DimMembershipAccountId'
      contracts:
        enforced: true
        columns:
          - name: DimMembershipAccountId
            data_type: integer
            constraints: ["primary key", "not null"]
          - name: AccountNumberFull
            data_type: varchar(20)
            constraints: ["not null", "unique"]
          - name: ClubNumber
            data_type: varchar(10)
            constraints: ["not null"]
          - name: HomeClubNumber
            data_type: varchar(10)
          - name: AccountType
            data_type: varchar(2)
            constraints: ["not null"]
          - name: AccountNumber
            data_type: varchar(10)
            constraints: ["not null"]
          - name: Complimentary
            data_type: varchar(1)
          - name: DateAccountOpened
            data_type: date
          - name: EffectiveDate
            data_type: date
          - name: ExpirationDate
            data_type: date
          - name: CancelDate
            data_type: date
          - name: BusinessName
            data_type: varchar(100)
          - name: BSBusinessType
            data_type: varchar(10)
          - name: PlatinumAccount
            data_type: varchar(1)
            constraints: ["not null"]
          - name: NumberOfEmployees
            data_type: integer
          - name: BusinessLicenseNumber
            data_type: text
          - name: CreateDate
            data_type: timestamp
            constraints: ["not null"]
          - name: UpdateDate
            data_type: timestamp
            constraints: ["not null"]
    columns:
      - name: DimMembershipAccountId
        description: "Auto-incremental primary key for membership accounts dimension"
      - name: AccountNumberFull
        description: "Business key - full account number (Cost Center + Account Number)"
      - name: ClubNumber
        description: "Club number where the account belongs"
      - name: HomeClubNumber
        description: "Home club number for the account"
      - name: AccountType
        description: "Type of account (DI=Individual, BS=Business)"
      - name: AccountNumber
        description: "Account number within the club"
      - name: Complimentary
        description: "Whether the account is complimentary"
      - name: DateAccountOpened
        description: "Date when the account was opened"
      - name: EffectiveDate
        description: "Effective date of the account"
      - name: ExpirationDate
        description: "Expiration date of the account"
      - name: CancelDate
        description: "Date when the account was cancelled"
      - name: BusinessName
        description: "Business name for business accounts"
      - name: BSBusinessType
        description: "Business type for business accounts"
      - name: PlatinumAccount
        description: "Whether the account is platinum"
      - name: NumberOfEmployees
        description: "Number of employees for business accounts"
      - name: BusinessLicenseNumber
        description: "Business license number"
      - name: CreateDate
        description: "Record creation timestamp"
      - name: UpdateDate
        description: "Record last update timestamp"
    tests:
      # Data Quality Tests (not enforced by contracts)
      - accepted_values:
          column_name: AccountType
          values: ['DI', 'BS']

  - name: DimMembershipCards
    description: "Dimension table for membership cards"
    config:
      materialized: table
      unique_key: 'DimMembershipCardId'
      contracts:
        enforced: true
        columns:
          - name: DimMembershipCardId
            data_type: integer
            constraints: ["primary key", "not null"]
          - name: MembershipNumber
            data_type: varchar(30)
            constraints: ["not null", "unique"]
          - name: AccountNumberFull
            data_type: varchar(20)
            constraints: ["not null"]
          - name: ClubNumber
            data_type: varchar(10)
            constraints: ["not null"]
          - name: CardNumber
            data_type: varchar(10)
            constraints: ["not null"]
          - name: BlockStatus
            data_type: varchar(10)
          - name: CancelDate
            data_type: date
          - name: HasCellPhone
            data_type: varchar(1)
            constraints: ["not null"]
          - name: HasEmail
            data_type: varchar(1)
            constraints: ["not null"]
          - name: MemEvent
            data_type: varchar(10)
          - name: Zone
            data_type: varchar(20)
          - name: AwarenessCode
            data_type: varchar(10)
          - name: WayOfNotification
            data_type: varchar(20)
          - name: DateOfBirth
            data_type: date
          - name: IssuedDate
            data_type: date
          - name: Gender
            data_type: varchar(1)
          - name: CardType
            data_type: varchar(10)
          - name: Country
            data_type: varchar(50)
          - name: DiamondBusinessType
            data_type: varchar(10)
          - name: MemberStatus
            data_type: varchar(10)
          - name: PrimaryCard
            data_type: varchar(1)
            constraints: ["not null"]
          - name: Dual
            data_type: varchar(1)
          - name: AutoCharge
            data_type: varchar(1)
          - name: CreateDate
            data_type: timestamp
            constraints: ["not null"]
          - name: UpdateDate
            data_type: timestamp
            constraints: ["not null"]
    columns:
      - name: DimMembershipCardId
        description: "Auto-incremental primary key for membership cards dimension"
      - name: MembershipNumber
        description: "Business key - full membership number (Cost Center + Account + Card)"
      - name: AccountNumberFull
        description: "Full account number this card belongs to"
      - name: ClubNumber
        description: "Club number where the card was issued"
      - name: CardNumber
        description: "Card number within the account"
      - name: BlockStatus
        description: "Status of the card (blocked/active)"
      - name: CancelDate
        description: "Date when the card was cancelled"
      - name: HasCellPhone
        description: "Whether the member has provided cell phone"
      - name: HasEmail
        description: "Whether the member has provided email"
      - name: MemEvent
        description: "Membership event code"
      - name: Zone
        description: "Geographic zone"
      - name: AwarenessCode
        description: "Awareness code for marketing"
      - name: WayOfNotification
        description: "Preferred way of notification"
      - name: DateOfBirth
        description: "Member's date of birth"
      - name: IssuedDate
        description: "Date when the card was issued"
      - name: Gender
        description: "Member's gender"
      - name: CardType
        description: "Type of membership card"
      - name: Country
        description: "Member's country"
      - name: DiamondBusinessType
        description: "Diamond business type"
      - name: MemberStatus
        description: "Status of the member"
      - name: PrimaryCard
        description: "Whether this is the primary card"
      - name: Dual
        description: "Dual membership indicator"
      - name: AutoCharge
        description: "Auto charge indicator"
      - name: CreateDate
        description: "Record creation timestamp"
      - name: UpdateDate
        description: "Record last update timestamp"

  - name: FactMembershipTransactions
    description: "Fact table for membership transactions"
    config:
      materialized: table
      unique_key: 'FactMembershipTransactionId'
      contracts:
        enforced: true
        columns:
          - name: FactMembershipTransactionId
            data_type: integer
            constraints: ["primary key", "not null"]
          - name: DimClubNumberId
            data_type: integer
            constraints: ["not null"]
          - name: DimMembershipAccountId
            data_type: integer
            constraints: ["not null"]
          - name: DimDateTransactionDateId
            data_type: integer
            constraints: ["not null"]
          - name: DimDateEffectiveDateId
            data_type: integer
          - name: DimDateExpiredDateId
            data_type: integer
          - name: AccountNumber
            data_type: varchar(10)
            constraints: ["not null"]
          - name: OrderNumber
            data_type: varchar(20)
            constraints: ["not null", "unique"]
          - name: TransactionDate
            data_type: date
            constraints: ["not null"]
          - name: AccountType
            data_type: varchar(2)
            constraints: ["not null"]
          - name: TransactionType
            data_type: varchar(20)
            constraints: ["not null"]
          - name: ExpiredDate
            data_type: date
          - name: EffectiveDate
            data_type: date
            constraints: ["not null"]
          - name: HomeCostCenter
            data_type: varchar(10)
          - name: PlatinumTransaction
            data_type: varchar(1)
          - name: SalesOrderNumber
            data_type: varchar(20)
          - name: InvoiceNumber
            data_type: varchar(20)
          - name: TotalCost
            data_type: decimal(15,2)
            constraints: ["not null"]
          - name: TotalUsdCostNet
            data_type: decimal(15,2)
            constraints: ["not null"]
          - name: CreateDate
            data_type: timestamp
            constraints: ["not null"]
          - name: UpdateDate
            data_type: timestamp
            constraints: ["not null"]
    columns:
      - name: FactMembershipTransactionId
        description: "Auto-incremental primary key for membership transactions fact"
      - name: DimClubNumberId
        description: "Foreign key to DimClubs.DimClubId"
      - name: DimMembershipAccountId
        description: "Foreign key to DimMembershipAccounts.DimMembershipAccountId"
      - name: DimDateTransactionDateId
        description: "Foreign key to DimDates.DimDateId for transaction date"
      - name: DimDateEffectiveDateId
        description: "Foreign key to DimDates.DimDateId for effective date"
      - name: DimDateExpiredDateId
        description: "Foreign key to DimDates.DimDateId for expired date"
      - name: AccountNumber
        description: "Account number for the transaction"
      - name: OrderNumber
        description: "Order number for the transaction"
      - name: TransactionDate
        description: "Date of the transaction"
      - name: AccountType
        description: "Type of account (DI/BS)"
      - name: TransactionType
        description: "Type of transaction"
      - name: ExpiredDate
        description: "Expiration date of the transaction"
      - name: EffectiveDate
        description: "Effective date of the transaction"
      - name: HomeCostCenter
        description: "Home cost center for the transaction"
      - name: PlatinumTransaction
        description: "Whether this is a platinum transaction"
      - name: SalesOrderNumber
        description: "Sales order number"
      - name: InvoiceNumber
        description: "Invoice number"
      - name: TotalCost
        description: "Total cost of the transaction"
      - name: TotalUsdCostNet
        description: "Total USD cost net of the transaction"
      - name: CreateDate
        description: "Record creation timestamp"
      - name: UpdateDate
        description: "Record last update timestamp"
    tests:
      # Foreign Key Relationship Tests (not enforced by contracts)
      - relationships:
          column_name: DimClubNumberId
          to: ref('DimClubs')
          field: DimClubId
      - relationships:
          column_name: DimMembershipAccountId
          to: ref('DimMembershipAccounts')
          field: DimMembershipAccountId
      - relationships:
          column_name: DimDateTransactionDateId
          to: ref('DimDates')
          field: DimDateId
      - relationships:
          column_name: DimDateEffectiveDateId
          to: ref('DimDates')
          field: DimDateId
      - relationships:
          column_name: DimDateExpiredDateId
          to: ref('DimDates')
          field: DimDateId
      # Data Quality Tests (not enforced by contracts)
      - accepted_values:
          column_name: AccountType
          values: ['DI', 'BS']
